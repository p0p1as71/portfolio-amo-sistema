# ADR-2026-003 — Escalabilidad y Desacoplamiento de M3

**Estado:** Aceptado / En implementación  
**Fecha:** 2026-01-20  
**Ámbito:** Arquitectura / Gobernanza / Ejecución  
**Módulo afectado:** M3 — Ejecutor Transaccional

---

## Contexto

Durante la fase de diseño de **M3 v3.0.0**, se evaluó la disyuntiva entre:

- Mantener un **motor unitario multifuncional de ejecución**, o  
- Migrar de forma prematura a una **arquitectura orientada a eventos** basada en microservicios (Variante B).

El análisis técnico determinó que el volumen de transacciones proyectado (**< 100 tx/seg**) no justifica, en el estado actual del sistema, la complejidad operativa, latencia añadida y coste cognitivo asociados a la introducción de un *message broker* (RabbitMQ, Kafka).

---

## Decisión

Se decide implementar **M3 v3.0.0** como un **Motor Unitario Multifuncional**, bajo el principio de **Desacoplamiento Modular Interno**.

Esto implica que:

- La **ejecución es centralizada**.
- La **lógica interna está fragmentada** en componentes técnicos independientes.
- No se introduce todavía una arquitectura distribuida basada en eventos.

### Capas internas de M3

- **Security** — Autenticación, HMAC, validación de integridad.
- **Firewall** — Filtrado técnico de entrada.
- **Persistence** — Persistencia transaccional y trazabilidad.
- **Pipelines** — Ejecución secuencial de flujos declarados.

Estas capas **no representan decisiones de negocio**, sino mecanismos técnicos de ejecución.

---

## Preparación para la Variante B (Event-Driven)

Aunque se mantiene el motor unitario, se establecen pilares explícitos para garantizar una transición futura sin reingeniería:

### 1. Contratos de datos estables
Uso de esquemas JSON estandarizados en la entrada, permitiendo que cada dominio funcional pueda desacoplarse en el futuro como microservicio independiente **sin modificar el origen del dato**.

### 2. Persistencia atómica (Event Store incipiente)
La tabla **`m3_transactions`** en Supabase actúa como un registro de eventos inicial, facilitando una futura integración con un *Event Bus* si el volumen de concurrencia lo requiere.

### 3. Independencia del transporte
La capa de seguridad basada en **HMAC** es agnóstica al medio de transporte, permitiendo escalado horizontal mediante balanceadores de carga sin comprometer la integridad del ecosistema A.M.O.

---

## Consecuencias

- Se prioriza la **simplicidad operativa** y la **robustez transaccional** en la fase actual.
- Se evita una sobrearquitectura prematura.
- El sistema queda explícitamente definido como **“Variante B Ready”**.
- La transición futura a microservicios se convierte en un **cambio de infraestructura**, no de lógica ni de contratos.

---

## Conclusión

El esfuerzo técnico realizado en M3 v3.0.0 asegura que A.M.O. pueda escalar hacia una arquitectura distribuida basada en eventos **cuando el negocio lo requiera**, sin reconstrucción de código ni ruptura semántica del sistema.

---

## Referencias

- Documento 0 — A.M.O.
- PROJECT_CONTEXT_CORE
- ADR-2026-004 — Sincronización Ontológica M0–M3

Propiedad de A.M.O. Lab - Confidencial. Ingeniería de Sistemas Automatizados por IA. R. Rubio
